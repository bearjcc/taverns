"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "_ssr_src_lib_game-engine_systems_ActionManager_js";
exports.ids = ["_ssr_src_lib_game-engine_systems_ActionManager_js"];
exports.modules = {

/***/ "(ssr)/./src/lib/game-engine/systems/ActionManager.js":
/*!******************************************************!*\
  !*** ./src/lib/game-engine/systems/ActionManager.js ***!
  \******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Action: () => (/* binding */ Action),\n/* harmony export */   ActionManager: () => (/* binding */ ActionManager)\n/* harmony export */ });\nclass ActionManager {\n    constructor(eventSystem, stateManager){\n        this.actions = new Map();\n        this.newlyUnlockedActions = new Set();\n        this.locationSystem = null;\n        this.configManager = null;\n        this.uiManager = null;\n        this.skillManager = null;\n        this.inventoryManager = null;\n        this.questSystem = null;\n        this.npcSystem = null;\n        this.eventSystem = eventSystem;\n        this.stateManager = stateManager;\n        // Initialize availability engine\n        this.availabilityEngine = new ActionAvailabilityEngine(eventSystem, stateManager);\n    }\n    /**\r\n     * Set the configuration manager reference\r\n     * @param {ConfigManager} configManager - The configuration manager instance\r\n     */ setConfigManager(configManager) {\n        this.configManager = configManager;\n    }\n    /**\r\n     * Set the UI manager reference\r\n     * @param {UIManager} uiManager - The UI manager instance\r\n     */ setUIManager(uiManager) {\n        this.uiManager = uiManager;\n    }\n    /**\r\n     * Set the skill manager reference\r\n     * @param {SkillManager} skillManager - The skill manager instance\r\n     */ setSkillSystem(skillManager) {\n        this.skillManager = skillManager;\n    }\n    /**\r\n     * Set the inventory manager reference\r\n     * @param {InventoryManager} inventoryManager - The inventory manager instance\r\n     */ setInventorySystem(inventoryManager) {\n        this.inventoryManager = inventoryManager;\n    }\n    /**\r\n     * Set the location system reference\r\n     * @param {LocationSystem} locationSystem - The location system instance\r\n     */ setLocationSystem(locationSystem) {\n        this.locationSystem = locationSystem;\n    }\n    /**\r\n     * Set the quest system reference\r\n     * @param {QuestSystem} questSystem - The quest system instance\r\n     */ setQuestSystem(questSystem) {\n        this.questSystem = questSystem;\n    }\n    /**\r\n     * Set the NPC system reference\r\n     * @param {NPCSystem} npcSystem - The NPC system instance\r\n     */ setNPCSystem(npcSystem) {\n        this.npcSystem = npcSystem;\n    }\n    loadFromConfig(actionsConfig) {\n        try {\n            console.log('Loading actions...');\n            this.actions.clear();\n            if (actionsConfig) {\n                for (const [skillType, skillData] of Object.entries(actionsConfig)){\n                    if (skillData.actions) {\n                        for (const actionData of skillData.actions){\n                            const action = new Action(actionData.name, actionData.displayName, actionData.description, actionData.icon, actionData.tooltip, actionData.levelRequired, actionData.xpReward, actionData.timeRequired, actionData.timeUnit, actionData.itemReward, actionData.itemCount, actionData.itemConsumption, actionData.unlockMessage, actionData.flavorText, actionData.skillType, actionData.variables, actionData.availability || {});\n                            this.actions.set(actionData.name, action);\n                        }\n                    }\n                }\n            }\n            console.log(`Loaded ${this.actions.size} actions`);\n        } catch (error) {\n            console.error('Error loading actions:', error);\n        }\n    }\n    getAction(actionName) {\n        return this.actions.get(actionName);\n    }\n    getAllActions() {\n        return Array.from(this.actions.values());\n    }\n    getAvailableActions() {\n        const availableActions = [];\n        for (const action of this.actions.values()){\n            const skill = this.skillManager ? this.skillManager.getSkill(action.skillType) : null;\n            if (!skill) continue;\n            // Check basic skill level requirement\n            if (skill.level < action.levelRequired) continue;\n            // Check dynamic availability using the availability engine\n            const context = this._buildActionContext();\n            const availability = this.availabilityEngine.checkActionAvailability(action, context);\n            if (availability.available) {\n                // Add availabilityInfo to the action instance without losing prototype methods\n                action.availabilityInfo = availability;\n                availableActions.push(action);\n            }\n        }\n        return availableActions;\n    }\n    /**\r\n     * Build context object for action availability checking\r\n     * @returns {Object} Context object with all necessary systems\r\n     */ _buildActionContext() {\n        return {\n            currentLocation: this.locationSystem ? this.locationSystem.getCurrentLocation() : null,\n            locationSystem: this.locationSystem,\n            inventoryManager: this.inventoryManager,\n            skillManager: this.skillManager,\n            questSystem: this.questSystem,\n            npcSystem: this.npcSystem,\n            configManager: this.configManager,\n            uiManager: this.uiManager\n        };\n    }\n    /**\r\n     * Execute an action\r\n     * @param {string} actionName - The name of the action to execute\r\n     * @param {*} variable - Optional variable parameter\r\n     * @returns {Object} Result of the action execution\r\n     */ executeAction(actionName, variable = null) {\n        const action = this.getAction(actionName);\n        if (!action) {\n            return {\n                success: false,\n                message: 'Action not found'\n            };\n        }\n        const skill = this.skillManager ? this.skillManager.getSkill(action.skillType) : null;\n        if (!skill) {\n            return {\n                success: false,\n                message: 'Skill not found'\n            };\n        }\n        // Check dynamic availability before execution\n        const context = this._buildActionContext();\n        const availability = this.availabilityEngine.checkActionAvailability(action, context);\n        if (!availability.available) {\n            const reason = availability.reasons.length > 0 ? availability.reasons[0] : 'Action not available';\n            return {\n                success: false,\n                message: reason\n            };\n        }\n        // Check if player can perform the action (basic requirements)\n        if (!action.canPerform(skill.level, this.inventoryManager)) {\n            return {\n                success: false,\n                message: `Requires ${action.skillType} level ${action.levelRequired}`\n            };\n        }\n        // Handle item consumption\n        for (const [itemId, requiredQuantity] of Object.entries(action.itemConsumption)){\n            if (!this.inventoryManager || !this.inventoryManager.hasItem(itemId, requiredQuantity)) {\n                const itemName = this.inventoryManager ? this.inventoryManager.getGameObject(itemId)?.displayName || itemId : itemId;\n                const message = this.configManager ? this.configManager.getMessage('actionInsufficientItems', {\n                    itemName\n                }) : `Insufficient ${itemName}`;\n                return {\n                    success: false,\n                    message\n                };\n            }\n        }\n        // Consume items\n        for (const [itemId, quantity] of Object.entries(action.itemConsumption)){\n            if (this.inventoryManager) {\n                this.inventoryManager.removeItem(itemId, quantity);\n                // Emit item consumed event for achievement tracking\n                if (this.eventSystem) {\n                    this.eventSystem.emit('item:consumed', {\n                        itemId: itemId,\n                        quantity: quantity,\n                        actionName: actionName\n                    });\n                }\n            }\n        }\n        // Record action usage for cooldown tracking\n        if (action.availability && action.availability.cooldown) {\n            this.availabilityEngine.recordActionUsage(actionName);\n        }\n        // Perform action and gain XP\n        const xpGained = action.performAction(skill, variable);\n        const itemReward = action.itemReward;\n        const itemCount = action.itemRewardQuantity || 1;\n        if (itemReward && this.inventoryManager) {\n            this.inventoryManager.addItem(itemReward, itemCount);\n            // Emit crafting completed event for achievement tracking\n            if (this.eventSystem && action.skillType === 'crafting') {\n                this.eventSystem.emit('craft:completed', {\n                    itemId: itemReward,\n                    quantity: itemCount,\n                    actionName: actionName\n                });\n            }\n        }\n        return {\n            success: true,\n            xpGained,\n            itemGained: itemReward,\n            itemCount,\n            message: action.flavorText || 'Action completed successfully'\n        };\n    }\n    /**\r\n     * Get actions available at a specific spot\r\n     * @param {string} spotId - The spot ID\r\n     * @returns {Array} Array of available actions\r\n     */ getActionsForSpot(spotId) {\n        if (!this.locationSystem) {\n            return this.getAvailableActions();\n        }\n        const spot = this.locationSystem._findSpotById(spotId);\n        if (!spot || !spot.actions) {\n            return [];\n        }\n        const availableActions = [];\n        for (const actionName of spot.actions){\n            const action = this.actions.get(actionName);\n            if (action) {\n                const skill = this.skillManager ? this.skillManager.getSkill(action.skillType) : null;\n                if (skill) {\n                    // Check dynamic availability\n                    const context = this._buildActionContext();\n                    const availability = this.availabilityEngine.checkActionAvailability(action, context);\n                    if (availability.available) {\n                        // Add availabilityInfo to the action instance without losing prototype methods\n                        action.availabilityInfo = availability;\n                        availableActions.push(action);\n                    }\n                }\n            }\n        }\n        return availableActions;\n    }\n    /**\r\n     * Get travel actions for current location\r\n     * @param {Object} playerState - Current player state\r\n     * @returns {Array} Array of travel actions\r\n     */ getTravelActions(playerState) {\n        if (!this.locationSystem) return [];\n        const availableSpots = this.locationSystem.getAvailableSpots();\n        const travelActions = [];\n        for (const spot of availableSpots){\n            const travelCheck = this.locationSystem.canTravelToSpot(spot.id, playerState);\n            if (travelCheck.canTravel) {\n                travelActions.push({\n                    name: `travel_to_${spot.id}`,\n                    displayName: `Travel to ${spot.name}`,\n                    description: spot.description,\n                    icon: \"ðŸš¶\",\n                    tooltip: `Travel to ${spot.name} (${spot.travelTime} minutes)`,\n                    levelRequired: 1,\n                    xpReward: 0,\n                    timeRequired: spot.travelTime || 1,\n                    timeUnit: \"minutes\",\n                    itemReward: null,\n                    itemCount: 0,\n                    itemConsumption: spot.travelCost?.items || {},\n                    unlockMessage: \"\",\n                    flavorText: `You travel to ${spot.name}.`,\n                    skillType: \"travel\",\n                    isTravelAction: true,\n                    targetSpotId: spot.id\n                });\n            }\n        }\n        return travelActions;\n    }\n    markActionAsNewlyUnlocked(actionName) {\n        this.newlyUnlockedActions.add(actionName);\n    }\n    isNewlyUnlocked(actionName) {\n        return this.newlyUnlockedActions.has(actionName);\n    }\n    markActionUsed(actionName) {\n        this.newlyUnlockedActions.delete(actionName);\n    }\n    checkForNewUnlocks(skillName, fromLevel, toLevel) {\n        for (const action of this.actions.values()){\n            if (action.skillType === skillName && action.levelRequired > fromLevel && action.levelRequired <= toLevel) {\n                this.markActionAsNewlyUnlocked(action.name);\n                if (this.configManager && this.uiManager) {\n                    const message = this.configManager.getMessage('actionUnlocked', {\n                        actionName: action.displayName,\n                        level: action.levelRequired\n                    });\n                    this.uiManager.addNarrationMessage(message);\n                }\n            }\n        }\n    }\n}\n// Action class for defining game actions\nclass Action {\n    constructor(name, displayName, description, icon, tooltip, levelRequired, xpReward, timeRequired, timeUnit, itemReward, itemCount, itemConsumption, unlockMessage, flavorText, skillType, variables = null, availability = {}){\n        this.name = name;\n        this.displayName = displayName;\n        this.description = description;\n        this.icon = icon;\n        this.tooltip = tooltip;\n        this.levelRequired = levelRequired;\n        this.xpReward = xpReward;\n        this.timeRequired = timeRequired || 0;\n        this.timeUnit = timeUnit || 'minutes';\n        this.itemReward = itemReward;\n        this.itemRewardQuantity = itemCount || 1;\n        this.itemConsumption = itemConsumption || {};\n        this.unlockMessage = unlockMessage;\n        this.flavorText = flavorText;\n        this.skillType = skillType;\n        this.variables = variables;\n        this.isTravelAction = false;\n        this.targetSpotId = null;\n        this.availability = availability;\n    }\n    canPerform(skillLevel, inventoryManager) {\n        if (skillLevel < this.levelRequired) {\n            return false;\n        }\n        // Check if player has required items\n        for (const [itemId, requiredQuantity] of Object.entries(this.itemConsumption)){\n            if (!inventoryManager.hasItem(itemId, requiredQuantity)) {\n                return false;\n            }\n        }\n        return true;\n    }\n    getTimeDisplay() {\n        if (this.timeRequired <= 0) return '';\n        const timeValue = this.timeRequired === Math.floor(this.timeRequired) ? this.timeRequired : this.timeRequired.toFixed(1);\n        return `${timeValue} ${this.timeUnit}`;\n    }\n    hasVariables() {\n        return this.variables !== null && Object.keys(this.variables).length > 0;\n    }\n    performAction(skill, variable = null) {\n        // Calculate XP based on variable amount if provided\n        let xpToGain = this.xpReward;\n        if (variable && this.variables && this.variables.amount) {\n            xpToGain = this.xpReward * variable;\n        }\n        // Add XP to the skill\n        if (skill && xpToGain > 0) {\n            skill.addXp(xpToGain);\n        }\n        return xpToGain;\n    }\n}\nif (false) {}\n// ES Module exports\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9zcmMvbGliL2dhbWUtZW5naW5lL3N5c3RlbXMvQWN0aW9uTWFuYWdlci5qcyIsIm1hcHBpbmdzIjoiOzs7OztBQUFBLE1BQU1BO0lBQ0ZDLFlBQVlDLFdBQVcsRUFBRUMsWUFBWSxDQUFFO1FBQ25DLElBQUksQ0FBQ0MsT0FBTyxHQUFHLElBQUlDO1FBQ25CLElBQUksQ0FBQ0Msb0JBQW9CLEdBQUcsSUFBSUM7UUFDaEMsSUFBSSxDQUFDQyxjQUFjLEdBQUc7UUFDdEIsSUFBSSxDQUFDQyxhQUFhLEdBQUc7UUFDckIsSUFBSSxDQUFDQyxTQUFTLEdBQUc7UUFDakIsSUFBSSxDQUFDQyxZQUFZLEdBQUc7UUFDcEIsSUFBSSxDQUFDQyxnQkFBZ0IsR0FBRztRQUN4QixJQUFJLENBQUNDLFdBQVcsR0FBRztRQUNuQixJQUFJLENBQUNDLFNBQVMsR0FBRztRQUNqQixJQUFJLENBQUNaLFdBQVcsR0FBR0E7UUFDbkIsSUFBSSxDQUFDQyxZQUFZLEdBQUdBO1FBRXBCLGlDQUFpQztRQUNqQyxJQUFJLENBQUNZLGtCQUFrQixHQUFHLElBQUlDLHlCQUF5QmQsYUFBYUM7SUFDeEU7SUFFQTs7O0tBR0MsR0FDRGMsaUJBQWlCUixhQUFhLEVBQUU7UUFDNUIsSUFBSSxDQUFDQSxhQUFhLEdBQUdBO0lBQ3pCO0lBRUE7OztLQUdDLEdBQ0RTLGFBQWFSLFNBQVMsRUFBRTtRQUNwQixJQUFJLENBQUNBLFNBQVMsR0FBR0E7SUFDckI7SUFFQTs7O0tBR0MsR0FDRFMsZUFBZVIsWUFBWSxFQUFFO1FBQ3pCLElBQUksQ0FBQ0EsWUFBWSxHQUFHQTtJQUN4QjtJQUVBOzs7S0FHQyxHQUNEUyxtQkFBbUJSLGdCQUFnQixFQUFFO1FBQ2pDLElBQUksQ0FBQ0EsZ0JBQWdCLEdBQUdBO0lBQzVCO0lBRUE7OztLQUdDLEdBQ0RTLGtCQUFrQmIsY0FBYyxFQUFFO1FBQzlCLElBQUksQ0FBQ0EsY0FBYyxHQUFHQTtJQUMxQjtJQUVBOzs7S0FHQyxHQUNEYyxlQUFlVCxXQUFXLEVB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QUFFRyxFQUFxQzNJO0FBRXhFLG9CQUFvQjtBQUNhIiwic291cmNlcyI6WyJDOlxcR2l0SHViXFxTZWxmXFx0YXZlcm5zXFxzcmNcXGxpYlxcZ2FtZS1lbmdpbmVcXHN5c3RlbXNcXEFjdGlvbk1hbmFnZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgQWN0aW9uTWFuYWdlciB7XHJcbiAgICBjb25zdHJ1Y3RvcihldmVudFN5c3RlbSwgc3RhdGVNYW5hZ2VyKSB7XHJcbiAgICAgICAgdGhpcy5hY3Rpb25zID0gbmV3IE1hcCgpO1xyXG4gICAgICAgIHRoaXMubmV3bHlVbmxvY2tlZEFjdGlvbnMgPSBuZXcgU2V0KCk7XHJcbiAgICAgICAgdGhpcy5sb2NhdGlvblN5c3RlbSA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5jb25maWdNYW5hZ2VyID0gbnVsbDtcclxuICAgICAgICB0aGlzLnVpTWFuYWdlciA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5za2lsbE1hbmFnZXIgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuaW52ZW50b3J5TWFuYWdlciA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5xdWVzdFN5c3RlbSA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5ucGNTeXN0ZW0gPSBudWxsO1xyXG4gICAgICAgIHRoaXMuZXZlbnRTeXN0ZW0gPSBldmVudFN5c3RlbTtcclxuICAgICAgICB0aGlzLnN0YXRlTWFuYWdlciA9IHN0YXRlTWFuYWdlcjtcclxuICAgICAgICBcclxuICAgICAgICAvLyBJbml0aWFsaXplIGF2YWlsYWJpbGl0eSBlbmdpbmVcclxuICAgICAgICB0aGlzLmF2YWlsYWJpbGl0eUVuZ2luZSA9IG5ldyBBY3Rpb25BdmFpbGFiaWxpdHlFbmdpbmUoZXZlbnRTeXN0ZW0sIHN0YXRlTWFuYWdlcik7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTZXQgdGhlIGNvbmZpZ3VyYXRpb24gbWFuYWdlciByZWZlcmVuY2VcclxuICAgICAqIEBwYXJhbSB7Q29uZmlnTWFuYWdlcn0gY29uZmlnTWFuYWdlciAtIFRoZSBjb25maWd1cmF0aW9uIG1hbmFnZXIgaW5zdGFuY2VcclxuICAgICAqL1xyXG4gICAgc2V0Q29uZmlnTWFuYWdlcihjb25maWdNYW5hZ2VyKSB7XHJcbiAgICAgICAgdGhpcy5jb25maWdNYW5hZ2VyID0gY29uZmlnTWFuYWdlcjtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFNldCB0aGUgVUkgbWFuYWdlciByZWZlcmVuY2VcclxuICAgICAqIEBwYXJhbSB7VUlNYW5hZ2VyfSB1aU1hbmFnZXIgLSBUaGUgVUkgbWFuYWdlciBpbnN0YW5jZVxyXG4gICAgICovXHJcbiAgICBzZXRVSU1hbmFnZXIodWlNYW5hZ2VyKSB7XHJcbiAgICAgICAgdGhpcy51aU1hbmFnZXIgPSB1aU1hbmFnZXI7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTZXQgdGhlIHNraWxsIG1hbmFnZXIgcmVmZXJlbmNlXHJcbiAgICAgKiBAcGFyYW0ge1NraWxsTWFuYWdlcn0gc2tpbGxNYW5hZ2VyIC0gVGhlIHNraWxsIG1hbmFnZXIgaW5zdGFuY2VcclxuICAgICAqL1xyXG4gICAgc2V0U2tpbGxTeXN0ZW0oc2tpbGxNYW5hZ2VyKSB7XHJcbiAgICAgICAgdGhpcy5za2lsbE1hbmFnZXIgPSBza2lsbE1hbmFnZXI7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTZXQgdGhlIGludmVudG9yeSBtYW5hZ2VyIHJlZmVyZW5jZVxyXG4gICAgICogQHBhcmFtIHtJbnZlbnRvcnlNYW5hZ2VyfSBpbnZlbnRvcnlNYW5hZ2VyIC0gVGhlIGludmVudG9yeSBtYW5hZ2VyIGluc3RhbmNlXHJcbiAgICAgKi9cclxuICAgIHNldEludmVudG9yeVN5c3RlbShpbnZlbnRvcnlNYW5hZ2VyKSB7XHJcbiAgICAgICAgdGhpcy5pbnZlbnRvcnlNYW5hZ2VyID0gaW52ZW50b3J5TWFuYWdlcjtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFNldCB0aGUgbG9jYXRpb24gc3lzdGVtIHJlZmVyZW5jZVxyXG4gICAgICogQHBhcmFtIHtMb2NhdGlvblN5c3RlbX0gbG9jYXRpb25TeXN0ZW0gLSBUaGUgbG9jYXRpb24gc3lzdGVtIGluc3RhbmNlXHJcbiAgICAgKi9cclxuICAgIHNldExvY2F0aW9uU3lzdGVtKGxvY2F0aW9uU3lzdGVtKSB7XHJcbiAgICAgICAgdGhpcy5sb2NhdGlvblN5c3RlbSA9IGxvY2F0aW9uU3lzdGVtO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogU2V0IHRoZSBxdWVzdCBzeXN0ZW0gcmVmZXJlbmNlXHJcbiAgICAgKiBAcGFyYW0ge1F1ZXN0U3lzdGVtfSBxdWVzdFN5c3RlbSAtIFRoZSBxdWVzdCBzeXN0ZW0gaW5zdGFuY2VcclxuICAgICAqL1xyXG4gICAgc2V0UXVlc3RTeXN0ZW0ocXVlc3RTeXN0ZW0pIHtcclxuICAgICAgICB0aGlzLnF1ZXN0U3lzdGVtID0gcXVlc3RTeXN0ZW07XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTZXQgdGhlIE5QQyBzeXN0ZW0gcmVmZXJlbmNlXHJcbiAgICAgKiBAcGFyYW0ge05QQ1N5c3RlbX0gbnBjU3lzdGVtIC0gVGhlIE5QQyBzeXN0ZW0gaW5zdGFuY2VcclxuICAgICAqL1xyXG4gICAgc2V0TlBDU3lzdGVtKG5wY1N5c3RlbSkge1xyXG4gICAgICAgIHRoaXMubnBjU3lzdGVtID0gbnBjU3lzdGVtO1xyXG4gICAgfVxyXG5cclxuICAgIGxvYWRGcm9tQ29uZmlnKGFjdGlvbnNDb25maWcpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnTG9hZGluZyBhY3Rpb25zLi4uJyk7XHJcbiAgICAgICAgICAgIHRoaXMuYWN0aW9ucy5jbGVhcigpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGFjdGlvbnNDb25maWcpIHtcclxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgW3NraWxsVHlwZSwgc2tpbGxEYXRhXSBvZiBPYmplY3QuZW50cmllcyhhY3Rpb25zQ29uZmlnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChza2lsbERhdGEuYWN0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGFjdGlvbkRhdGEgb2Ygc2tpbGxEYXRhLmFjdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFjdGlvbiA9IG5ldyBBY3Rpb24oXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uRGF0YS5uYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkRhdGEuZGlzcGxheU5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uRGF0YS5kZXNjcmlwdGlvbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25EYXRhLmljb24sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uRGF0YS50b29sdGlwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkRhdGEubGV2ZWxSZXF1aXJlZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25EYXRhLnhwUmV3YXJkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkRhdGEudGltZVJlcXVpcmVkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkRhdGEudGltZVVuaXQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uRGF0YS5pdGVtUmV3YXJkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkRhdGEuaXRlbUNvdW50LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkRhdGEuaXRlbUNvbnN1bXB0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkRhdGEudW5sb2NrTWVzc2FnZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25EYXRhLmZsYXZvclRleHQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uRGF0YS5za2lsbFR5cGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uRGF0YS52YXJpYWJsZXMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uRGF0YS5hdmFpbGFiaWxpdHkgfHwge31cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGlvbnMuc2V0KGFjdGlvbkRhdGEubmFtZSwgYWN0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc29sZS5sb2coYExvYWRlZCAke3RoaXMuYWN0aW9ucy5zaXplfSBhY3Rpb25zYCk7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgbG9hZGluZyBhY3Rpb25zOicsIGVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0QWN0aW9uKGFjdGlvbk5hbWUpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5hY3Rpb25zLmdldChhY3Rpb25OYW1lKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRBbGxBY3Rpb25zKCkge1xyXG4gICAgICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuYWN0aW9ucy52YWx1ZXMoKSk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0QXZhaWxhYmxlQWN0aW9ucygpIHtcclxuICAgICAgICBjb25zdCBhdmFpbGFibGVBY3Rpb25zID0gW107XHJcbiAgICAgICAgXHJcbiAgICAgICAgZm9yIChjb25zdCBhY3Rpb24gb2YgdGhpcy5hY3Rpb25zLnZhbHVlcygpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNraWxsID0gdGhpcy5za2lsbE1hbmFnZXIgPyB0aGlzLnNraWxsTWFuYWdlci5nZXRTa2lsbChhY3Rpb24uc2tpbGxUeXBlKSA6IG51bGw7XHJcbiAgICAgICAgICAgIGlmICghc2tpbGwpIGNvbnRpbnVlO1xyXG5cclxuICAgICAgICAgICAgLy8gQ2hlY2sgYmFzaWMgc2tpbGwgbGV2ZWwgcmVxdWlyZW1lbnRcclxuICAgICAgICAgICAgaWYgKHNraWxsLmxldmVsIDwgYWN0aW9uLmxldmVsUmVxdWlyZWQpIGNvbnRpbnVlO1xyXG5cclxuICAgICAgICAgICAgLy8gQ2hlY2sgZHluYW1pYyBhdmFpbGFiaWxpdHkgdXNpbmcgdGhlIGF2YWlsYWJpbGl0eSBlbmdpbmVcclxuICAgICAgICAgICAgY29uc3QgY29udGV4dCA9IHRoaXMuX2J1aWxkQWN0aW9uQ29udGV4dCgpO1xyXG4gICAgICAgICAgICBjb25zdCBhdmFpbGFiaWxpdHkgPSB0aGlzLmF2YWlsYWJpbGl0eUVuZ2luZS5jaGVja0FjdGlvbkF2YWlsYWJpbGl0eShhY3Rpb24sIGNvbnRleHQpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYgKGF2YWlsYWJpbGl0eS5hdmFpbGFibGUpIHtcclxuICAgICAgICAgICAgICAgIC8vIEFkZCBhdmFpbGFiaWxpdHlJbmZvIHRvIHRoZSBhY3Rpb24gaW5zdGFuY2Ugd2l0aG91dCBsb3NpbmcgcHJvdG90eXBlIG1ldGhvZHNcclxuICAgICAgICAgICAgICAgIGFjdGlvbi5hdmFpbGFiaWxpdHlJbmZvID0gYXZhaWxhYmlsaXR5O1xyXG4gICAgICAgICAgICAgICAgYXZhaWxhYmxlQWN0aW9ucy5wdXNoKGFjdGlvbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuIGF2YWlsYWJsZUFjdGlvbnM7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBCdWlsZCBjb250ZXh0IG9iamVjdCBmb3IgYWN0aW9uIGF2YWlsYWJpbGl0eSBjaGVja2luZ1xyXG4gICAgICogQHJldHVybnMge09iamVjdH0gQ29udGV4dCBvYmplY3Qgd2l0aCBhbGwgbmVjZXNzYXJ5IHN5c3RlbXNcclxuICAgICAqL1xyXG4gICAgX2J1aWxkQWN0aW9uQ29udGV4dCgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBjdXJyZW50TG9jYXRpb246IHRoaXMubG9jYXRpb25TeXN0ZW0gPyB0aGlzLmxvY2F0aW9uU3lzdGVtLmdldEN1cnJlbnRMb2NhdGlvbigpIDogbnVsbCxcclxuICAgICAgICAgICAgbG9jYXRpb25TeXN0ZW06IHRoaXMubG9jYXRpb25TeXN0ZW0sXHJcbiAgICAgICAgICAgIGludmVudG9yeU1hbmFnZXI6IHRoaXMuaW52ZW50b3J5TWFuYWdlcixcclxuICAgICAgICAgICAgc2tpbGxNYW5hZ2VyOiB0aGlzLnNraWxsTWFuYWdlcixcclxuICAgICAgICAgICAgcXVlc3RTeXN0ZW06IHRoaXMucXVlc3RTeXN0ZW0sXHJcbiAgICAgICAgICAgIG5wY1N5c3RlbTogdGhpcy5ucGNTeXN0ZW0sXHJcbiAgICAgICAgICAgIGNvbmZpZ01hbmFnZXI6IHRoaXMuY29uZmlnTWFuYWdlcixcclxuICAgICAgICAgICAgdWlNYW5hZ2VyOiB0aGlzLnVpTWFuYWdlclxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBFeGVjdXRlIGFuIGFjdGlvblxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGFjdGlvbk5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgYWN0aW9uIHRvIGV4ZWN1dGVcclxuICAgICAqIEBwYXJhbSB7Kn0gdmFyaWFibGUgLSBPcHRpb25hbCB2YXJpYWJsZSBwYXJhbWV0ZXJcclxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJlc3VsdCBvZiB0aGUgYWN0aW9uIGV4ZWN1dGlvblxyXG4gICAgICovXHJcbiAgICBleGVjdXRlQWN0aW9uKGFjdGlvbk5hbWUsIHZhcmlhYmxlID0gbnVsbCkge1xyXG4gICAgICAgIGNvbnN0IGFjdGlvbiA9IHRoaXMuZ2V0QWN0aW9uKGFjdGlvbk5hbWUpO1xyXG4gICAgICAgIGlmICghYWN0aW9uKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiAnQWN0aW9uIG5vdCBmb3VuZCcgfTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHNraWxsID0gdGhpcy5za2lsbE1hbmFnZXIgPyB0aGlzLnNraWxsTWFuYWdlci5nZXRTa2lsbChhY3Rpb24uc2tpbGxUeXBlKSA6IG51bGw7XHJcbiAgICAgICAgaWYgKCFza2lsbCkge1xyXG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogJ1NraWxsIG5vdCBmb3VuZCcgfTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIENoZWNrIGR5bmFtaWMgYXZhaWxhYmlsaXR5IGJlZm9yZSBleGVjdXRpb25cclxuICAgICAgICBjb25zdCBjb250ZXh0ID0gdGhpcy5fYnVpbGRBY3Rpb25Db250ZXh0KCk7XHJcbiAgICAgICAgY29uc3QgYXZhaWxhYmlsaXR5ID0gdGhpcy5hdmFpbGFiaWxpdHlFbmdpbmUuY2hlY2tBY3Rpb25BdmFpbGFiaWxpdHkoYWN0aW9uLCBjb250ZXh0KTtcclxuICAgICAgICBcclxuICAgICAgICBpZiAoIWF2YWlsYWJpbGl0eS5hdmFpbGFibGUpIHtcclxuICAgICAgICAgICAgY29uc3QgcmVhc29uID0gYXZhaWxhYmlsaXR5LnJlYXNvbnMubGVuZ3RoID4gMCA/IGF2YWlsYWJpbGl0eS5yZWFzb25zWzBdIDogJ0FjdGlvbiBub3QgYXZhaWxhYmxlJztcclxuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IHJlYXNvbiB9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgcGxheWVyIGNhbiBwZXJmb3JtIHRoZSBhY3Rpb24gKGJhc2ljIHJlcXVpcmVtZW50cylcclxuICAgICAgICBpZiAoIWFjdGlvbi5jYW5QZXJmb3JtKHNraWxsLmxldmVsLCB0aGlzLmludmVudG9yeU1hbmFnZXIpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBgUmVxdWlyZXMgJHthY3Rpb24uc2tpbGxUeXBlfSBsZXZlbCAke2FjdGlvbi5sZXZlbFJlcXVpcmVkfWAgfTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIEhhbmRsZSBpdGVtIGNvbnN1bXB0aW9uXHJcbiAgICAgICAgZm9yIChjb25zdCBbaXRlbUlkLCByZXF1aXJlZFF1YW50aXR5XSBvZiBPYmplY3QuZW50cmllcyhhY3Rpb24uaXRlbUNvbnN1bXB0aW9uKSkge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuaW52ZW50b3J5TWFuYWdlciB8fCAhdGhpcy5pbnZlbnRvcnlNYW5hZ2VyLmhhc0l0ZW0oaXRlbUlkLCByZXF1aXJlZFF1YW50aXR5KSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaXRlbU5hbWUgPSB0aGlzLmludmVudG9yeU1hbmFnZXIgPyB0aGlzLmludmVudG9yeU1hbmFnZXIuZ2V0R2FtZU9iamVjdChpdGVtSWQpPy5kaXNwbGF5TmFtZSB8fCBpdGVtSWQgOiBpdGVtSWQ7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gdGhpcy5jb25maWdNYW5hZ2VyID8gdGhpcy5jb25maWdNYW5hZ2VyLmdldE1lc3NhZ2UoJ2FjdGlvbkluc3VmZmljaWVudEl0ZW1zJywgeyBpdGVtTmFtZSB9KSA6IGBJbnN1ZmZpY2llbnQgJHtpdGVtTmFtZX1gO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2UgfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ29uc3VtZSBpdGVtc1xyXG4gICAgICAgIGZvciAoY29uc3QgW2l0ZW1JZCwgcXVhbnRpdHldIG9mIE9iamVjdC5lbnRyaWVzKGFjdGlvbi5pdGVtQ29uc3VtcHRpb24pKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmludmVudG9yeU1hbmFnZXIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW52ZW50b3J5TWFuYWdlci5yZW1vdmVJdGVtKGl0ZW1JZCwgcXVhbnRpdHkpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvLyBFbWl0IGl0ZW0gY29uc3VtZWQgZXZlbnQgZm9yIGFjaGlldmVtZW50IHRyYWNraW5nXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5ldmVudFN5c3RlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXZlbnRTeXN0ZW0uZW1pdCgnaXRlbTpjb25zdW1lZCcsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbUlkOiBpdGVtSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHF1YW50aXR5OiBxdWFudGl0eSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uTmFtZTogYWN0aW9uTmFtZVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZWNvcmQgYWN0aW9uIHVzYWdlIGZvciBjb29sZG93biB0cmFja2luZ1xyXG4gICAgICAgIGlmIChhY3Rpb24uYXZhaWxhYmlsaXR5ICYmIGFjdGlvbi5hdmFpbGFiaWxpdHkuY29vbGRvd24pIHtcclxuICAgICAgICAgICAgdGhpcy5hdmFpbGFiaWxpdHlFbmdpbmUucmVjb3JkQWN0aW9uVXNhZ2UoYWN0aW9uTmFtZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBQZXJmb3JtIGFjdGlvbiBhbmQgZ2FpbiBYUFxyXG4gICAgICAgIGNvbnN0IHhwR2FpbmVkID0gYWN0aW9uLnBlcmZvcm1BY3Rpb24oc2tpbGwsIHZhcmlhYmxlKTtcclxuICAgICAgICBjb25zdCBpdGVtUmV3YXJkID0gYWN0aW9uLml0ZW1SZXdhcmQ7XHJcbiAgICAgICAgY29uc3QgaXRlbUNvdW50ID0gYWN0aW9uLml0ZW1SZXdhcmRRdWFudGl0eSB8fCAxO1xyXG5cclxuICAgICAgICBpZiAoaXRlbVJld2FyZCAmJiB0aGlzLmludmVudG9yeU1hbmFnZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5pbnZlbnRvcnlNYW5hZ2VyLmFkZEl0ZW0oaXRlbVJld2FyZCwgaXRlbUNvdW50KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIEVtaXQgY3JhZnRpbmcgY29tcGxldGVkIGV2ZW50IGZvciBhY2hpZXZlbWVudCB0cmFja2luZ1xyXG4gICAgICAgICAgICBpZiAodGhpcy5ldmVudFN5c3RlbSAmJiBhY3Rpb24uc2tpbGxUeXBlID09PSAnY3JhZnRpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmV2ZW50U3lzdGVtLmVtaXQoJ2NyYWZ0OmNvbXBsZXRlZCcsIHtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtSWQ6IGl0ZW1SZXdhcmQsXHJcbiAgICAgICAgICAgICAgICAgICAgcXVhbnRpdHk6IGl0ZW1Db3VudCxcclxuICAgICAgICAgICAgICAgICAgICBhY3Rpb25OYW1lOiBhY3Rpb25OYW1lXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICAgICAgeHBHYWluZWQsXHJcbiAgICAgICAgICAgIGl0ZW1HYWluZWQ6IGl0ZW1SZXdhcmQsXHJcbiAgICAgICAgICAgIGl0ZW1Db3VudCxcclxuICAgICAgICAgICAgbWVzc2FnZTogYWN0aW9uLmZsYXZvclRleHQgfHwgJ0FjdGlvbiBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5J1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBHZXQgYWN0aW9ucyBhdmFpbGFibGUgYXQgYSBzcGVjaWZpYyBzcG90XHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gc3BvdElkIC0gVGhlIHNwb3QgSURcclxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gQXJyYXkgb2YgYXZhaWxhYmxlIGFjdGlvbnNcclxuICAgICAqL1xyXG4gICAgZ2V0QWN0aW9uc0ZvclNwb3Qoc3BvdElkKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmxvY2F0aW9uU3lzdGVtKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEF2YWlsYWJsZUFjdGlvbnMoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHNwb3QgPSB0aGlzLmxvY2F0aW9uU3lzdGVtLl9maW5kU3BvdEJ5SWQoc3BvdElkKTtcclxuICAgICAgICBpZiAoIXNwb3QgfHwgIXNwb3QuYWN0aW9ucykge1xyXG4gICAgICAgICAgICByZXR1cm4gW107XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBhdmFpbGFibGVBY3Rpb25zID0gW107XHJcbiAgICAgICAgZm9yIChjb25zdCBhY3Rpb25OYW1lIG9mIHNwb3QuYWN0aW9ucykge1xyXG4gICAgICAgICAgICBjb25zdCBhY3Rpb24gPSB0aGlzLmFjdGlvbnMuZ2V0KGFjdGlvbk5hbWUpO1xyXG4gICAgICAgICAgICBpZiAoYWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBza2lsbCA9IHRoaXMuc2tpbGxNYW5hZ2VyID8gdGhpcy5za2lsbE1hbmFnZXIuZ2V0U2tpbGwoYWN0aW9uLnNraWxsVHlwZSkgOiBudWxsO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNraWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgZHluYW1pYyBhdmFpbGFiaWxpdHlcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb250ZXh0ID0gdGhpcy5fYnVpbGRBY3Rpb25Db250ZXh0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYXZhaWxhYmlsaXR5ID0gdGhpcy5hdmFpbGFiaWxpdHlFbmdpbmUuY2hlY2tBY3Rpb25BdmFpbGFiaWxpdHkoYWN0aW9uLCBjb250ZXh0KTtcclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYXZhaWxhYmlsaXR5LmF2YWlsYWJsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBBZGQgYXZhaWxhYmlsaXR5SW5mbyB0byB0aGUgYWN0aW9uIGluc3RhbmNlIHdpdGhvdXQgbG9zaW5nIHByb3RvdHlwZSBtZXRob2RzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbi5hdmFpbGFiaWxpdHlJbmZvID0gYXZhaWxhYmlsaXR5O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhdmFpbGFibGVBY3Rpb25zLnB1c2goYWN0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBhdmFpbGFibGVBY3Rpb25zO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogR2V0IHRyYXZlbCBhY3Rpb25zIGZvciBjdXJyZW50IGxvY2F0aW9uXHJcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gcGxheWVyU3RhdGUgLSBDdXJyZW50IHBsYXllciBzdGF0ZVxyXG4gICAgICogQHJldHVybnMge0FycmF5fSBBcnJheSBvZiB0cmF2ZWwgYWN0aW9uc1xyXG4gICAgICovXHJcbiAgICBnZXRUcmF2ZWxBY3Rpb25zKHBsYXllclN0YXRlKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmxvY2F0aW9uU3lzdGVtKSByZXR1cm4gW107XHJcblxyXG4gICAgICAgIGNvbnN0IGF2YWlsYWJsZVNwb3RzID0gdGhpcy5sb2NhdGlvblN5c3RlbS5nZXRBdmFpbGFibGVTcG90cygpO1xyXG4gICAgICAgIGNvbnN0IHRyYXZlbEFjdGlvbnMgPSBbXTtcclxuXHJcbiAgICAgICAgZm9yIChjb25zdCBzcG90IG9mIGF2YWlsYWJsZVNwb3RzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRyYXZlbENoZWNrID0gdGhpcy5sb2NhdGlvblN5c3RlbS5jYW5UcmF2ZWxUb1Nwb3Qoc3BvdC5pZCwgcGxheWVyU3RhdGUpO1xyXG4gICAgICAgICAgICBpZiAodHJhdmVsQ2hlY2suY2FuVHJhdmVsKSB7XHJcbiAgICAgICAgICAgICAgICB0cmF2ZWxBY3Rpb25zLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IGB0cmF2ZWxfdG9fJHtzcG90LmlkfWAsXHJcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6IGBUcmF2ZWwgdG8gJHtzcG90Lm5hbWV9YCxcclxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogc3BvdC5kZXNjcmlwdGlvbixcclxuICAgICAgICAgICAgICAgICAgICBpY29uOiBcIvCfmrZcIixcclxuICAgICAgICAgICAgICAgICAgICB0b29sdGlwOiBgVHJhdmVsIHRvICR7c3BvdC5uYW1lfSAoJHtzcG90LnRyYXZlbFRpbWV9IG1pbnV0ZXMpYCxcclxuICAgICAgICAgICAgICAgICAgICBsZXZlbFJlcXVpcmVkOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgIHhwUmV3YXJkOiAwLFxyXG4gICAgICAgICAgICAgICAgICAgIHRpbWVSZXF1aXJlZDogc3BvdC50cmF2ZWxUaW1lIHx8IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgdGltZVVuaXQ6IFwibWludXRlc1wiLFxyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1SZXdhcmQ6IG51bGwsXHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbUNvdW50OiAwLFxyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1Db25zdW1wdGlvbjogc3BvdC50cmF2ZWxDb3N0Py5pdGVtcyB8fCB7fSxcclxuICAgICAgICAgICAgICAgICAgICB1bmxvY2tNZXNzYWdlOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgICAgIGZsYXZvclRleHQ6IGBZb3UgdHJhdmVsIHRvICR7c3BvdC5uYW1lfS5gLFxyXG4gICAgICAgICAgICAgICAgICAgIHNraWxsVHlwZTogXCJ0cmF2ZWxcIixcclxuICAgICAgICAgICAgICAgICAgICBpc1RyYXZlbEFjdGlvbjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICB0YXJnZXRTcG90SWQ6IHNwb3QuaWRcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdHJhdmVsQWN0aW9ucztcclxuICAgIH1cclxuXHJcbiAgICBtYXJrQWN0aW9uQXNOZXdseVVubG9ja2VkKGFjdGlvbk5hbWUpIHtcclxuICAgICAgICB0aGlzLm5ld2x5VW5sb2NrZWRBY3Rpb25zLmFkZChhY3Rpb25OYW1lKTtcclxuICAgIH1cclxuXHJcbiAgICBpc05ld2x5VW5sb2NrZWQoYWN0aW9uTmFtZSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLm5ld2x5VW5sb2NrZWRBY3Rpb25zLmhhcyhhY3Rpb25OYW1lKTtcclxuICAgIH1cclxuXHJcbiAgICBtYXJrQWN0aW9uVXNlZChhY3Rpb25OYW1lKSB7XHJcbiAgICAgICAgdGhpcy5uZXdseVVubG9ja2VkQWN0aW9ucy5kZWxldGUoYWN0aW9uTmFtZSk7XHJcbiAgICB9XHJcblxyXG4gICAgY2hlY2tGb3JOZXdVbmxvY2tzKHNraWxsTmFtZSwgZnJvbUxldmVsLCB0b0xldmVsKSB7XHJcbiAgICAgICAgZm9yIChjb25zdCBhY3Rpb24gb2YgdGhpcy5hY3Rpb25zLnZhbHVlcygpKSB7XHJcbiAgICAgICAgICAgIGlmIChhY3Rpb24uc2tpbGxUeXBlID09PSBza2lsbE5hbWUgJiYgXHJcbiAgICAgICAgICAgICAgICBhY3Rpb24ubGV2ZWxSZXF1aXJlZCA+IGZyb21MZXZlbCAmJiBcclxuICAgICAgICAgICAgICAgIGFjdGlvbi5sZXZlbFJlcXVpcmVkIDw9IHRvTGV2ZWwpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubWFya0FjdGlvbkFzTmV3bHlVbmxvY2tlZChhY3Rpb24ubmFtZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jb25maWdNYW5hZ2VyICYmIHRoaXMudWlNYW5hZ2VyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IHRoaXMuY29uZmlnTWFuYWdlci5nZXRNZXNzYWdlKCdhY3Rpb25VbmxvY2tlZCcsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uTmFtZTogYWN0aW9uLmRpc3BsYXlOYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXZlbDogYWN0aW9uLmxldmVsUmVxdWlyZWRcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVpTWFuYWdlci5hZGROYXJyYXRpb25NZXNzYWdlKG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG4vLyBBY3Rpb24gY2xhc3MgZm9yIGRlZmluaW5nIGdhbWUgYWN0aW9uc1xyXG5jbGFzcyBBY3Rpb24ge1xyXG4gICAgY29uc3RydWN0b3IobmFtZSwgZGlzcGxheU5hbWUsIGRlc2NyaXB0aW9uLCBpY29uLCB0b29sdGlwLCBsZXZlbFJlcXVpcmVkLCB4cFJld2FyZCwgdGltZVJlcXVpcmVkLCB0aW1lVW5pdCwgaXRlbVJld2FyZCwgaXRlbUNvdW50LCBpdGVtQ29uc3VtcHRpb24sIHVubG9ja01lc3NhZ2UsIGZsYXZvclRleHQsIHNraWxsVHlwZSwgdmFyaWFibGVzID0gbnVsbCwgYXZhaWxhYmlsaXR5ID0ge30pIHtcclxuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xyXG4gICAgICAgIHRoaXMuZGlzcGxheU5hbWUgPSBkaXNwbGF5TmFtZTtcclxuICAgICAgICB0aGlzLmRlc2NyaXB0aW9uID0gZGVzY3JpcHRpb247XHJcbiAgICAgICAgdGhpcy5pY29uID0gaWNvbjtcclxuICAgICAgICB0aGlzLnRvb2x0aXAgPSB0b29sdGlwO1xyXG4gICAgICAgIHRoaXMubGV2ZWxSZXF1aXJlZCA9IGxldmVsUmVxdWlyZWQ7XHJcbiAgICAgICAgdGhpcy54cFJld2FyZCA9IHhwUmV3YXJkO1xyXG4gICAgICAgIHRoaXMudGltZVJlcXVpcmVkID0gdGltZVJlcXVpcmVkIHx8IDA7XHJcbiAgICAgICAgdGhpcy50aW1lVW5pdCA9IHRpbWVVbml0IHx8ICdtaW51dGVzJztcclxuICAgICAgICB0aGlzLml0ZW1SZXdhcmQgPSBpdGVtUmV3YXJkO1xyXG4gICAgICAgIHRoaXMuaXRlbVJld2FyZFF1YW50aXR5ID0gaXRlbUNvdW50IHx8IDE7XHJcbiAgICAgICAgdGhpcy5pdGVtQ29uc3VtcHRpb24gPSBpdGVtQ29uc3VtcHRpb24gfHwge307XHJcbiAgICAgICAgdGhpcy51bmxvY2tNZXNzYWdlID0gdW5sb2NrTWVzc2FnZTtcclxuICAgICAgICB0aGlzLmZsYXZvclRleHQgPSBmbGF2b3JUZXh0O1xyXG4gICAgICAgIHRoaXMuc2tpbGxUeXBlID0gc2tpbGxUeXBlO1xyXG4gICAgICAgIHRoaXMudmFyaWFibGVzID0gdmFyaWFibGVzO1xyXG4gICAgICAgIHRoaXMuaXNUcmF2ZWxBY3Rpb24gPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnRhcmdldFNwb3RJZCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5hdmFpbGFiaWxpdHkgPSBhdmFpbGFiaWxpdHk7XHJcbiAgICB9XHJcblxyXG4gICAgY2FuUGVyZm9ybShza2lsbExldmVsLCBpbnZlbnRvcnlNYW5hZ2VyKSB7XHJcbiAgICAgICAgaWYgKHNraWxsTGV2ZWwgPCB0aGlzLmxldmVsUmVxdWlyZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgcGxheWVyIGhhcyByZXF1aXJlZCBpdGVtc1xyXG4gICAgICAgIGZvciAoY29uc3QgW2l0ZW1JZCwgcmVxdWlyZWRRdWFudGl0eV0gb2YgT2JqZWN0LmVudHJpZXModGhpcy5pdGVtQ29uc3VtcHRpb24pKSB7XHJcbiAgICAgICAgICAgIGlmICghaW52ZW50b3J5TWFuYWdlci5oYXNJdGVtKGl0ZW1JZCwgcmVxdWlyZWRRdWFudGl0eSkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0VGltZURpc3BsYXkoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMudGltZVJlcXVpcmVkIDw9IDApIHJldHVybiAnJztcclxuICAgICAgICBcclxuICAgICAgICBjb25zdCB0aW1lVmFsdWUgPSB0aGlzLnRpbWVSZXF1aXJlZCA9PT0gTWF0aC5mbG9vcih0aGlzLnRpbWVSZXF1aXJlZCkgXHJcbiAgICAgICAgICAgID8gdGhpcy50aW1lUmVxdWlyZWQgXHJcbiAgICAgICAgICAgIDogdGhpcy50aW1lUmVxdWlyZWQudG9GaXhlZCgxKTtcclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gYCR7dGltZVZhbHVlfSAke3RoaXMudGltZVVuaXR9YDtcclxuICAgIH1cclxuXHJcbiAgICBoYXNWYXJpYWJsZXMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudmFyaWFibGVzICE9PSBudWxsICYmIE9iamVjdC5rZXlzKHRoaXMudmFyaWFibGVzKS5sZW5ndGggPiAwO1xyXG4gICAgfVxyXG5cclxuICAgIHBlcmZvcm1BY3Rpb24oc2tpbGwsIHZhcmlhYmxlID0gbnVsbCkge1xyXG4gICAgICAgIC8vIENhbGN1bGF0ZSBYUCBiYXNlZCBvbiB2YXJpYWJsZSBhbW91bnQgaWYgcHJvdmlkZWRcclxuICAgICAgICBsZXQgeHBUb0dhaW4gPSB0aGlzLnhwUmV3YXJkO1xyXG4gICAgICAgIGlmICh2YXJpYWJsZSAmJiB0aGlzLnZhcmlhYmxlcyAmJiB0aGlzLnZhcmlhYmxlcy5hbW91bnQpIHtcclxuICAgICAgICAgICAgeHBUb0dhaW4gPSB0aGlzLnhwUmV3YXJkICogdmFyaWFibGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIEFkZCBYUCB0byB0aGUgc2tpbGxcclxuICAgICAgICBpZiAoc2tpbGwgJiYgeHBUb0dhaW4gPiAwKSB7XHJcbiAgICAgICAgICAgIHNraWxsLmFkZFhwKHhwVG9HYWluKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuIHhwVG9HYWluO1xyXG4gICAgfVxyXG59XHJcblxyXG5pZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHdpbmRvdy5BY3Rpb25NYW5hZ2VyID0gQWN0aW9uTWFuYWdlcjtcclxuXHJcbi8vIEVTIE1vZHVsZSBleHBvcnRzXHJcbmV4cG9ydCB7IEFjdGlvbk1hbmFnZXIsIEFjdGlvbiB9OyAiXSwibmFtZXMiOlsiQWN0aW9uTWFuYWdlciIsImNvbnN0cnVjdG9yIiwiZXZlbnRTeXN0ZW0iLCJzdGF0ZU1hbmFnZXIiLCJhY3Rpb25zIiwiTWFwIiwibmV3bHlVbmxvY2tlZEFjdGlvbnMiLCJTZXQiLCJsb2NhdGlvblN5c3RlbSIsImNvbmZpZ01hbmFnZXIiLCJ1aU1hbmFnZXIiLCJza2lsbE1hbmFnZXIiLCJpbnZlbnRvcnlNYW5hZ2VyIiwicXVlc3RTeXN0ZW0iLCJucGNTeXN0ZW0iLCJhdmFpbGFiaWxpdHlFbmdpbmUiLCJBY3Rpb25BdmFpbGFiaWxpdHlFbmdpbmUiLCJzZXRDb25maWdNYW5hZ2VyIiwic2V0VUlNYW5hZ2VyIiwic2V0U2tpbGxTeXN0ZW0iLCJzZXRJbnZlbnRvcnlTeXN0ZW0iLCJzZXRMb2NhdGlvblN5c3RlbSIsInNldFF1ZXN0U3lzdGVtIiwic2V0TlBDU3lzdGVtIiwibG9hZEZyb21Db25maWciLCJhY3Rpb25zQ29uZmlnIiwiY29uc29sZSIsImxvZyIsImNsZWFyIiwic2tpbGxUeXBlIiwic2tpbGxEYXRhIiwiT2JqZWN0IiwiZW50cmllcyIsImFjdGlvbkRhdGEiLCJhY3Rpb24iLCJBY3Rpb24iLCJuYW1lIiwiZGlzcGxheU5hbWUiLCJkZXNjcmlwdGlvbiIsImljb24iLCJ0b29sdGlwIiwibGV2ZWxSZXF1aXJlZCIsInhwUmV3YXJkIiwidGltZVJlcXVpcmVkIiwidGltZVVuaXQiLCJpdGVtUmV3YXJkIiwiaXRlbUNvdW50IiwiaXRlbUNvbnN1bXB0aW9uIiwidW5sb2NrTWVzc2FnZSIsImZsYXZvclRleHQiLCJ2YXJpYWJsZXMiLCJhdmFpbGFiaWxpdHkiLCJzZXQiLCJzaXplIiwiZXJyb3IiLCJnZXRBY3Rpb24iLCJhY3Rpb25OYW1lIiwiZ2V0IiwiZ2V0QWxsQWN0aW9ucyIsIkFycmF5IiwiZnJvbSIsInZhbHVlcyIsImdldEF2YWlsYWJsZUFjdGlvbnMiLCJhdmFpbGFibGVBY3Rpb25zIiwic2tpbGwiLCJnZXRTa2lsbCIsImxldmVsIiwiY29udGV4dCIsIl9idWlsZEFjdGlvbkNvbnRleHQiLCJjaGVja0FjdGlvbkF2YWlsYWJpbGl0eSIsImF2YWlsYWJsZSIsImF2YWlsYWJpbGl0eUluZm8iLCJwdXNoIiwiY3VycmVudExvY2F0aW9uIiwiZ2V0Q3VycmVudExvY2F0aW9uIiwiZXhlY3V0ZUFjdGlvbiIsInZhcmlhYmxlIiwic3VjY2VzcyIsIm1lc3NhZ2UiLCJyZWFzb24iLCJyZWFzb25zIiwibGVuZ3RoIiwiY2FuUGVyZm9ybSIsIml0ZW1JZCIsInJlcXVpcmVkUXVhbnRpdHkiLCJoYXNJdGVtIiwiaXRlbU5hbWUiLCJnZXRHYW1lT2JqZWN0IiwiZ2V0TWVzc2FnZSIsInF1YW50aXR5IiwicmVtb3ZlSXRlbSIsImVtaXQiLCJjb29sZG93biIsInJlY29yZEFjdGlvblVzYWdlIiwieHBHYWluZWQiLCJwZXJmb3JtQWN0aW9uIiwiaXRlbVJld2FyZFF1YW50aXR5IiwiYWRkSXRlbSIsIml0ZW1HYWluZWQiLCJnZXRBY3Rpb25zRm9yU3BvdCIsInNwb3RJZCIsInNwb3QiLCJfZmluZFNwb3RCeUlkIiwiZ2V0VHJhdmVsQWN0aW9ucyIsInBsYXllclN0YXRlIiwiYXZhaWxhYmxlU3BvdHMiLCJnZXRBdmFpbGFibGVTcG90cyIsInRyYXZlbEFjdGlvbnMiLCJ0cmF2ZWxDaGVjayIsImNhblRyYXZlbFRvU3BvdCIsImlkIiwiY2FuVHJhdmVsIiwidHJhdmVsVGltZSIsInRyYXZlbENvc3QiLCJpdGVtcyIsImlzVHJhdmVsQWN0aW9uIiwidGFyZ2V0U3BvdElkIiwibWFya0FjdGlvbkFzTmV3bHlVbmxvY2tlZCIsImFkZCIsImlzTmV3bHlVbmxvY2tlZCIsImhhcyIsIm1hcmtBY3Rpb25Vc2VkIiwiZGVsZXRlIiwiY2hlY2tGb3JOZXdVbmxvY2tzIiwic2tpbGxOYW1lIiwiZnJvbUxldmVsIiwidG9MZXZlbCIsImFkZE5hcnJhdGlvbk1lc3NhZ2UiLCJza2lsbExldmVsIiwiZ2V0VGltZURpc3BsYXkiLCJ0aW1lVmFsdWUiLCJNYXRoIiwiZmxvb3IiLCJ0b0ZpeGVkIiwiaGFzVmFyaWFibGVzIiwia2V5cyIsInhwVG9HYWluIiwiYW1vdW50IiwiYWRkWHAiLCJ3aW5kb3ciXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./src/lib/game-engine/systems/ActionManager.js\n");

/***/ })

};
;